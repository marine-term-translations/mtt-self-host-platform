@prefix ldes: <https://w3id.org/ldes#> .
@prefix tree: <https://w3id.org/tree#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

@base <{{ prefix_uri }}/{{ source_id }}/{{ fragment_timestamp }}.ttl> .

<>
    a tree:Node ;

{% if has_previous %}
    tree:relation [
        a tree:GreaterThanOrEqualToRelation ;
        tree:node <{{ prefix_uri }}/{{ source_id }}/{{ prev_fragment_timestamp }}.ttl> ;
        tree:path dcterms:modified ;
        tree:value {{ prev_fragment_time | xsd("datetime") }}
    ] .
{% else %}
    .
{% endif %}

<feed>
    a ldes:EventStream ;
    ldes:timestampPath {{ldes_timestampPath_property | uri }} ;
    ldes:versionOfPath {{ldes_versionOfPath_property | uri }} ;
    tree:view <{{ prefix_uri }}/{{ source_id }}/{{ fragment_timestamp }}.ttl> .

{% for item in sets.qres %}
    <feed> tree:member <{{ item.concept }}> .
{{ item.concept | uri }}
    a {% for type in types %}
        {{ type | uri }}{% if not loop.last %} ,{% endif %}
    {% endfor %} ;
    {{ldes_versionOfPath_property | uri }} {{ item.concept | uri }} ;
    {{ldes_timestampPath_property | uri }} {{ item.modified  | xsd("datetime")}} ;
{% for field_uri, field_values in item.fields.items() %}
{% for field_value in field_values %}
    {{ field_uri | uri }} {{ field_value.value | xsd("@"~field_value.language)}};
{% endfor %}
{% endfor %}
    .
{% endfor %}
